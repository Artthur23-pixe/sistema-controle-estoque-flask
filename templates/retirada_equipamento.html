
{% extends "base.html" %}

{% block content %}
    <h1>Retirada de Equipamento</h1>
    <hr>
    <form method="post">
        <!-- Campos Comuns -->
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="responsavel" class="form-label">Responsável pela Retirada</label>
                <input type="text" class="form-control" id="responsavel" name="responsavel" required>
            </div>
            <div class="col-md-6 mb-3">
                <label for="destino" class="form-label">Destino do Material</label>
                <input type="text" class="form-control" id="destino" name="destino" required>
            </div>
        </div>
        <div class="mb-3">
            <label for="chamado" class="form-label">Número ou Título do Chamado (Opcional)</label>
            <input type="text" class="form-control" id="chamado" name="chamado">
        </div>
        <hr>

        <!-- Container para os itens dinâmicos -->
        <div id="items-container">
            <!-- Primeira linha de item -->
            <div class="row item-row mb-2 align-items-end">
                <div class="col-md-7">
                    <label class="form-label">Equipamento</label>
                    <select class="form-select" name="produto_id[]" required>
                        <option value="" disabled selected>Selecione um equipamento...</option>
                        {% for produto in produtos %}{% if produto.quantidade > 0 %}<option value="{{ produto.id }}">{{ produto.nome }} (Disponível: {{ produto.quantidade }})</option>{% endif %}{% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Quantidade</label>
                    <input type="number" class="form-control" name="quantidade[]" min="1" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger w-100" onclick="removeItem(this)">Remover</button>
                </div>
            </div>
        </div>
        
        <!-- Botão para adicionar mais itens -->
        <button type="button" class="btn btn-outline-success mt-2" onclick="addItem()">Adicionar Outro Equipamento</button>

        <hr>
        <button type="submit" class="btn btn-danger">Confirmar Retirada de Todos os Itens</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancelar</a>
    </form>

    <!-- Template para novas linhas de item -->
    <template id="item-template">
        <div class="row item-row mb-2 align-items-end">
            <div class="col-md-7">
                <label class="form-label">Equipamento</label>
                <select class="form-select" name="produto_id[]" required>
                    <option value="" disabled selected>Selecione um equipamento...</option>
                    {% for produto in produtos %}{% if produto.quantidade > 0 %}<option value="{{ produto.id }}">{{ produto.nome }} (Disponível: {{ produto.quantidade }})</option>{% endif %}{% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Quantidade</label>
                <input type="number" class="form-control" name="quantidade[]" min="1" required>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" onclick="removeItem(this)">Remover</button>
            </div>
        </div>
    </template>
{% endblock %}