{% extends "base.html" %}

{% block content %}
<!-- Início do Dashboard -->
<h1 class="mb-4">Painel Principal</h1>
<div class="row mb-4">
<!-- ... (código do dashboard continua o mesmo) ... -->
<div class="col-md-4"><div class="card text-white bg-primary mb-3"><div class="card-body"><h5 class="card-title">Produtos Distintos</h5><p class="card-text fs-4">{{ total_produtos_distintos }}</p></div></div></div>
<div class="col-md-4"><div class="card text-white bg-success mb-3"><div class="card-body"><h5 class="card-title">Total de Itens em Estoque</h5><p class="card-text fs-4">{{ total_itens_estoque }}</p></div></div></div>
<div class="col-md-4"><div class="card text-white {{ 'bg-danger' if produtos_estoque_baixo else 'bg-secondary' }} mb-3"><div class="card-body"><h5 class="card-title">Itens com Estoque Baixo</h5><p class="card-text fs-4">{{ produtos_estoque_baixo|length }}</p></div></div></div>
</div>
{% if produtos_estoque_baixo %}
<div class="alert alert-danger">
<strong>Atenção!</strong> Os seguintes produtos possuem apenas <strong>1 unidade</strong> restante em estoque:
<ul>
{% for produto in produtos_estoque_baixo %}
<li>{{ produto.nome }} ({{ produto.quantidade }} unidade)</li>
{% endfor %}
</ul>
</div>
{% endif %}
<!-- Fim do Dashboard -->

<hr class="my-4">

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Lista de Estoque Completa</h2>
    <a href="{{ url_for('adicionar_produto') }}" class="btn btn-primary">Adicionar Novo Produto</a>
</div>

<!-- Formulário de Filtro de Categoria -->
<form method="get" class="mb-4 p-3 border rounded">
    <div class="row align-items-end">
        <div class="col-md-4">
            <label for="categoria" class="form-label">Filtrar por Categoria</label>
            <select class="form-select" name="categoria" id="categoria" onchange="this.form.submit()">
                <option value="">Todas as Categorias</option>
                {% for cat in categorias %}
                <option value="{{ cat }}" {{ 'selected' if cat == categoria_selecionada else '' }}>{{ cat }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
</form>

{% if not inventario and categoria_selecionada %}
    <div class="alert alert-warning">Nenhum produto encontrado na categoria selecionada. <a href="{{ url_for('index') }}">Ver todos.</a></div>
{% elif not inventario %}
    <div class="alert alert-info">O inventário está vazio.</div>
{% else %}
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Produto</th>
                    <th>Categoria</th> <!-- NOVA COLUNA -->
                    <th>Quantidade</th>
                    <th>Descrição</th>
                    <th class="text-end">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for produto in inventario %}
                <tr>
                    <td>{{ produto.nome }}</td>
                    <td>{{ produto.categoria or 'N/A' }}</td> <!-- NOVA COLUNA -->
                    <td class="{{ 'text-danger fw-bold' if produto in produtos_estoque_baixo else '' }}">{{ produto.quantidade }}</td>
                    <td>{{ produto.descricao or 'N/A' }}</td>
                    <td class="text-end">
                        <a href="{{ url_for('editar_produto', produto_id=produto.id) }}" class="btn btn-warning btn-sm me-1">Editar</a>
                        <form action="{{ url_for('excluir_produto', produto_id=produto.id) }}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-dark btn-sm" onclick="return confirm('Tem a certeza?');">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
{% endblock %}